@if (state.activeSection() === 'overview') {
  <app-admin-overview></app-admin-overview>
} @else {
  <div class="page-header">
    <h2 class="page-title">{{ state.pageTitle() }}</h2>
    @if (state.activeSection() === 'delivery') {
      <button (click)="openAgentModal()" class="btn-primary">+ Add Delivery Agent</button>
    }
  </div>

  <div class="table-card">
    <table class="admin-table">
      @switch (state.activeSection()) {
        @case ('applications') {
          <thead>
            <tr>
              <th>
                <button (click)="sortData('restaurantName')" class="sort-header">
                  Restaurant
                  <span class="sort-indicator" [class.active]="state.sortConfig()['applications']?.column === 'restaurantName'">
                    {{ state.sortConfig()['applications']?.direction === 'asc' ? '▲' : '▼' }}
                  </span>
                </button>
              </th>
              <th>Applicant</th>
              <th>Contact</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            @for(app of sortedApplications(); track app.id) {
              <tr>
                <td>{{ app.restaurantName }}</td>
                <td>{{ app.applicant?.name }} ({{ app.applicant?.email }})</td>
                <td>{{ app.phoneNumber }}</td>
                <td>
                  <div class="action-buttons">
                    <button (click)="approve(app)" class="btn-sm btn-success">Approve</button>
                    <button (click)="reject(app)" class="btn-sm btn-danger">Reject</button>
                  </div>
                </td>
              </tr>
            } @empty {
              <tr><td colspan="4" class="empty-state">No pending applications.</td></tr>
            }
          </tbody>
        }

        @case ('restaurants') {
          <thead>
            <tr>
              <th>
                <button (click)="sortData('id')" class="sort-header">ID
                  <span class="sort-indicator" [class.active]="state.sortConfig()['restaurants']?.column === 'id'">
                    {{ state.sortConfig()['restaurants']?.direction === 'asc' ? '▲' : '▼' }}
                  </span>
                </button>
              </th>
              <th>
                <button (click)="sortData('name')" class="sort-header">Name
                  <span class="sort-indicator" [class.active]="state.sortConfig()['restaurants']?.column === 'name'">
                    {{ state.sortConfig()['restaurants']?.direction === 'asc' ? '▲' : '▼' }}
                  </span>
                </button>
              </th>
              <th>Address</th>
              <th>Owner</th>
            </tr>
          </thead>
          <tbody>
            @for(item of sortedRestaurants(); track item.id) {
              <tr>
                <td>{{ item.id }}</td>
                <td>{{ item.name }}</td>
                <td>{{ item.address }}</td>
                <td>{{ item.ownerName }}</td>
              </tr>
            } @empty {
              <tr><td colspan="4" class="empty-state">No restaurants found.</td></tr>
            }
          </tbody>
        }

        @case ('users') {
          <thead>
            <tr>
              <th>
                <button (click)="sortData('id')" class="sort-header">ID
                  <span class="sort-indicator" [class.active]="state.sortConfig()['users']?.column === 'id'">
                    {{ state.sortConfig()['users']?.direction === 'asc' ? '▲' : '▼' }}
                  </span>
                </button>
              </th>
              <th>
                <button (click)="sortData('name')" class="sort-header">Name
                  <span class="sort-indicator" [class.active]="state.sortConfig()['users']?.column === 'name'">
                    {{ state.sortConfig()['users']?.direction === 'asc' ? '▲' : '▼' }}
                  </span>
                </button>
              </th>
              <th>Email</th>
              <th>Phone</th>
              <th>Role</th>
            </tr>
          </thead>
          <tbody>
            @for(user of sortedUsers(); track user.id) {
              <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td>{{ user.phoneNumber }}</td>
                <td>{{ user.role }}</td>
              </tr>
            } @empty {
              <tr><td colspan="5" class="empty-state">No users found.</td></tr>
            }
          </tbody>
        }

        @case ('orders') {
          <thead>
            <tr>
              <th>ID</th>
              <th>Customer</th>
              <th>Restaurant</th>
              <th>Total</th>
              <th>Status</th>
              <th>Time</th>
            </tr>
          </thead>
          <tbody>
            @for(order of sortedOrders(); track order.id) {
              <tr>
                <td>#{{ order.id }}</td>
                <td>{{ order.customerName }}</td>
                <td>{{ order.restaurantName }}</td>
                <td>₹{{ order.totalPrice.toFixed(2) }}</td>
                <td>{{ order.status }}</td>
                <td>{{ order.orderTime | date:'short' }}</td>
              </tr>
            } @empty {
              <tr><td colspan="6" class="empty-state">No orders found.</td></tr>
            }
          </tbody>
        }

        @case ('delivery') {
          <thead>
            <tr>
              <th>ID</th>
              <th>Name</th>
              <th>Email</th>
              <th>Phone</th>
            </tr>
          </thead>
          <tbody>
            @for(agent of sortedDeliveryAgents(); track agent.id) {
              <tr>
                <td>{{ agent.id }}</td>
                <td>{{ agent.name }}</td>
                <td>{{ agent.email }}</td>
                <td>{{ agent.phoneNumber }}</td>
              </tr>
            } @empty {
              <tr><td colspan="4" class="empty-state">No delivery agents found.</td></tr>
            }
          </tbody>
        }
      }
    </table>
  </div>
}

<!-- Add Agent Modal -->
@if(isAgentModalOpen()) {
  <div class="modal-overlay" (click)="closeAgentModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3 class="modal-title">Add New Delivery Agent</h3>
        <button (click)="closeAgentModal()" class="close-btn">&times;</button>
      </div>
      <form class="modal-body" (ngSubmit)="onAddAgentSubmit()">
        <div class="form-grid">
          <div class="form-field">
            <label>Name</label>
            <input type="text" name="name" required class="form-input" [(ngModel)]="newAgentForm.name" />
          </div>
          <div class="form-field">
            <label>Email</label>
            <input type="email" name="email" required class="form-input" [(ngModel)]="newAgentForm.email" />
          </div>
          <div class="form-field">
            <label>Phone Number</label>
            <input type="text" name="phoneNumber" required class="form-input" [(ngModel)]="newAgentForm.phoneNumber" />
          </div>
          <div class="form-field">
            <label>Password</label>
            <input type="password" name="password" required class="form-input" [(ngModel)]="newAgentForm.password" />
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" (click)="closeAgentModal()" class="btn-secondary">Cancel</button>
          <button type="submit" class="btn-submit">Create Agent</button>
        </div>
      </form>
    </div>
  </div>
}
