<main class="page-container">
  <div class="page-header">
    <h1 class="page-title">My Profile</h1>
    <p class="page-subtitle">Manage your personal information and profile picture.</p>
  </div>

  <div class="profile-card">
    @if (profile(); as p) {
      <form (ngSubmit)="onSubmit()">
        <div class="avatar-section">
          <button type="button" class="avatar-image-button" (click)="openViewModal()" title="View larger image">
            <img 
              [src]="imagePreviewUrl ? imagePreviewUrl : (getProfileImageUrl() | fullUrl)" 
              alt="Profile Picture" 
              class="avatar-image"
            >
          </button>
          <div class="avatar-actions">
            <label for="profile-image-upload" class="btn-secondary upload-btn">
              <span>Change Picture</span>
              <input type="file" id="profile-image-upload" class="hidden" (change)="onFileSelected($event)" accept="image/*">
            </label>
            <p class="upload-hint">JPG, GIF or PNG. 1MB max.</p>
          </div>
        </div>

        <hr class="form-divider">

        <div class="form-fields">
          <div class="form-field">
            <label for="profile-name">Full Name</label>
            <input type="text" id="profile-name" name="name" class="form-input" required [(ngModel)]="p.name">
          </div>
          <div class="form-field">
            <label for="profile-email">Email Address</label>
            <input type="email" id="profile-email" name="email" class="form-input" [value]="p.email" disabled>
          </div>
          <div class="form-field">
            <label for="profile-phone">Phone Number</label>
            <input type="tel" id="profile-phone" name="phoneNumber" class="form-input" required [(ngModel)]="p.phoneNumber">
          </div>
        </div>
        
        <div class="form-footer">
          <button type="submit" class="btn-submit save-btn">Save Changes</button>
        </div>
      </form>
    } @else {
      <div class="text-center p-8">
        <p class="text-text-dark">Loading your profile...</p>
      </div>
    }
  </div>
</main>

@if (isViewModalVisible()) {
  <div class="view-modal-overlay" (click)="closeViewModal()">
    <div class="view-modal-content" (click)="$event.stopPropagation()">
      <img 
        [src]="imagePreviewUrl ? imagePreviewUrl : (getProfileImageUrl() | fullUrl)" 
        alt="Enlarged profile picture" 
        class="enlarged-image"
      >
    </div>
  </div>
}